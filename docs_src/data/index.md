<!---
#_created: 2015-08-01
#_updated: 2015-08-01
#author: your name
--->

# What is wig?

wigは、素早く確実にWebサイトを更新し続けるために作られた、静的サイトジェネレータです。
継承というコンセプトを活用し、できるだけ「コピペ」をする事なく、DRYに静的サイトを構築することができます。

# Concept

wigのコンセプトは「DRY」です。

Webサイトを作っている時に、こんなこともまれによくあります。

* グローバルナビゲーションに修正が入って、全ページを書き換えないといけなくなった
* 大量にある同じレイアウトのページでレイアウト変更が入って、全部書き換えないといけなくなった

そんな時、わざわざ全てのページを開いて、HTMLを書き換えるのは、手間もかかりますしミスも多くなります。
そんな苦労から一切おさらばし、より安全確実に、スピーディにWebサイトを更新し続けられるようにと作られたのがwigです。

wigでは、テンプレートエンジンや、JSON等によるデータ定義を活用することで、早く確実なサイト構築を実現します。


## もう少し詳しく

Webページは、「データ」と「テンプレート」に分解することができます。


wigでは、この「データ」と「テンプレート」を作ることで、サイトを構築していきます。


Webサイトは、大抵はディレクトリ構造を持っています。
同じディレクトリ内にあるページは、同じようなデータとテンプレートで表示される事が多いはずです。
なので、データは階層構造を持ち、親階層で定義されたデータを、子階層で継承、オーバーライド（上書き）できます。

テンプレートは、nunjucksの力によって、テンプレートを継承したり、macroやincludeを活用するなどして、効率的に書く事ができます。


# Quick-start


wigをインストールします。

```
npm install wig
```

ディレクトリを作ります

```
```

ビルドコマンドを叩きます

```
wig build
```

もしくは、gulpなどのタスクランナーで、ビルドコマンドを走らせます。

最小限のセットアップ（gulpを使う場合）は、[リポジトリ](#)に例があります。
CSSなどを含めたセットアップは、[actless](https://github.com/zk33/actless)を使うと便利です。


# Setup data

データには、２つの役割があります。

* どの階層に、どういう名前のページを出力するかを定義する
* ページ内に出力する内容/パラメータを定義する

## ページ定義

ページの定義は、２つの方法があります。

### 出力したいファイルと同名のファイルを置く

`data`ディレクトリ内に
`data/index.text`
`data/index.md`
などのファイルを置いてビルドすると、
`public`ディレクトリに
`public/index.html`
が出力されます。

**ファイル名は、`_`（アンダースコア）から始めることはできません。（_から始まったファイルは、パラメータとして処理されます）**

### `_contents`パラメータを使う

`data`ディレクトリ内に置いたJSONファイル（またはJSファイル）で、`_contents`というパラメータを設定すると、それに基づいてページが出力されます。

```
{
  "_contents":{
    "index":{
      "title":"indexページ"
    },
    "profile":{
      "title":"プロフィール"
    },
    "works":{
      "_contents":{
        "work1":{
          "title":"作品1"
        },
        "work2":{
          "title":"作品2"
        }
      }
    }
    "contact":{
      "title":"お問い合わせ"
    }
  }
}

```

その際、`_contents`が定義されているファイル名がディレクトリになります。
もし↑の内容が`data/hello,json`に書かれていた場合は、`public/hello/index.html`や`public/hello/profile.html`が出力されます。
ディレクトリを作りたくない場合は、`__init__.json`というファイルに書いてください。

## パラメータの定義

テンプレートに渡すパラメータを定義することができます。

### ファイル内で定義する
### ファイルで定義する
### 継承の仕組み
### 特殊パラメータ

`_ext`
ファイルを出力する時に、拡張子を指定したものに変更することができます。

`_template`
テンプレートのファイル名を指定します

# Templating

wigは、テンプレートエンジンとしてnunjucksを採用しています。
nunjucksは、jinja2をベースにしたテンプレートエンジンで、継承の仕組みを持っています。

テンプレートの詳細は、nunjucksのドキュメントをご覧ください。
nunjucks以外のテンプレートエンジンを使いたい場合は、rendererを書くことで対応できます。

## テンプレートの決定の仕組み

ファイルを出力する際、`template`フォルダ内のどのテンプレートを使ってレンダリングするかは、`data`で決められたファイル名を元にして、自動的に決まる仕組みになっています。

### テンプレートのルール

1. 出力ファイルと完全に同じディレクトリ/ファイル名のテンプレートを探します /foo/bar.html -> /foo/bar.html
2. ディレクトリの区切りをアンダースコアに置換したものを探します /foo/bar.html -> foo\_bar.html
3. ディレクトリ内に`__base__.html`があれば、それを使います /foo/bar.html -> foo/\_\_base\_\_.html
4. 1階層上に上がって、同じことを繰り返します。

たとえば、出力するファイルが、`/spam/egg/ham.php`の場合、

```
/spam/egg/ham.php
/spam/egg/ham.html
/spam_egg_ham.php
/spam_egg_ham.html
/spam/egg/__base__.php
/spam/egg/__base__.html
/spam/egg.php
/spam/egg.html
/spam_egg.php
/spam_egg.html
/spam/__base__.php
/spam/__base__.html
/spam.php
/spam.html
/__base__.php
/__base__.html
```

これを上から順に探して、見つかったテンプレートを使います。

このルールから外れたテンプレートを使いたい場合は、dataで該当するファイル/ディレクトリのところに`_template`変数で指定してください。



## 自動出力されるテンプレート変数

`data`ディレクトリ内で定義された変数以外に、自動で生成されてテンプレートに渡される変数があります。

`_rel_root`
`public`のルートディレクトリまでの相対パスを出力します。
サイト内のリンクを相対パスで書きたい場合などに便利です。


# API
